@using GrowBox.Abstractions.Model
@using GrowBox.State
@using GrowBox.Controls

@page "/growbox/create"

@inject App App
@inject NavigationManager NavigationManager
@inject ILogger<GrowBoxCreate> Logger
@inject NotificationService NotificationService

<GrowBoxEditor Submit="@OnSubmit" GrowBox="_growBox" />

@code
{
    private readonly GrowBox _growBox = new()
    {
        GrowBoxUrl = "http://growbox01/",
        Icon = "yard", 
        WebCamStreamUrl = "http://growbox.local:8091/?action=stream", 
        WebCamSnapshotUrl = "http://growbox.local:8091/?action=snapshot",
    };
    
    private async Task OnSubmit(GrowBox growBox)
    {
        try
        {
            var result = await App.CreateGrowBox(growBox);
            NavigationManager.NavigateTo($"/growbox/{result.Id}");
        }
        catch (Exception e)
        {
            var message = new NotificationMessage
            {
                Severity = NotificationSeverity.Error,
                Summary = "Growbox Creation",
                Detail = "Failed.",
                Duration = 2000
            };
            NotificationService.Notify(message);
            Logger.LogError(e, "Failed to create growbox.");
        }
    }
}
